# CTF-Creator

The Capture-The-Flag (CTF)-Creator is a Python-based project designed to automate the setup of a CTF environment by managing Docker containers, networking, and security configurations. It simplifies the process of provisioning resources for multiple users, ensuring each participant has a dedicated and secure environment tailored to the CTF requirements and creating OpenVPN files for a secure connection with the CTF environment.

By integrating with Docker, SSH, and networking tools, the main function facilitates the creation of isolated environments where participants can engage in challenges, exercises, or simulations typical of CTF competitions. This automation not only saves time but also enhances the scalability and consistency of CTF environments across different hosts and setups.

## Folders and Files

The project consists of three folders:
1. **src**: Where all relevant files and scripts are:
    - `ctf_main.py` : Contains the main function.
    - `docker_functions.py`
    - `pyyaml_functions.py'`
    - `hosts_functions.py`
    - `ovpn_helper_functions.py`
    - `pyyaml_functions.py`
    - `readme_functions.py`
    - `validation_functions.py`
    - `test.yaml` : YAML Configuration file

2. **tests**: Contains several `pyyaml` tests to verify the functionalities of the CTF-creator.
3. **example_generated_data**: This folder provides examples of the user data generated by the CTF-Creator to connect to the CTF environment. Each user has their own folder named user_user_name, which contains:

   - `client.ovpn`: An OVPN configuration file for connecting to the secure CTF environment.
   - `README.md`: Explains how to use the client.ovpn file.
   - `dockovpn_data.tar`: Backup data for the OpenVPN server.

## Installation Instructions

Python 3 and several Python libraries need to be installed:
    - 

**Recommendation**: Before running `ctf_main.py`, create a Python virtual environment:
```bash
python3 -m venv .venv
source .venv/bin/activate
```
## Requirements 
Provide a YAML configuration file with the following arguments:

-     name: Name of the YAML configuration (e.g., my_config).
-     containers: Docker containers that get started for each user in a specific subnet isolated from other users (e.g., nginx:latest).
-     users: List of users of the CTF environment created by the CTF-Creator.
-     identityFile: Path to the private SSH keys for host logins.
-     hosts: Hosts where the Docker containers for the CTF environment are running. Entries should start with the host username, followed by @, and then the IP address of the host (e.g., ubuntu@10.20.30.101).
-     subnet_first_part: First segment of the subnet IP address (e.g., 10 in 10.xx.xx.xx/24).
-     subnet_second_part: Second segment of the subnet IP address. (e.g., 13 in xx.13.xx.xx/24).
-     subnet_third_part: Third segment of the subnet IP address (e.g., 0 in xx.xx.0.xx/24).

### Requirements for the remote hosts specified in the YAML configuration 

1.     You need to install [Docker] (https://docs.docker.com/engine/install/ubuntu/)
2.     You need to configure [remote access Docker daemon] (https://docs.docker.com/engine/daemon/remote-access/)
3.         



## Usage
Run ctf_main.py with Python 3 in the src folder.

Provide the location of your YAML configuration file and where you want to store the created data for the connection to the CTF environment.

For connecting to the hosts, it will also ask for your terminal password.

## Testing
To run all tests at once you can run this command in the terminal in the main folder `ctf-creator/`:
```bash
python3 -m pytest -v 
```

## Features

#### Main Function Overview

The main function orchestrates the entire setup process for the CTF-Creator, leveraging various helper functions and external libraries like Docker, Paramiko (SSH), and Click (command-line interface).
Key Functionalities:

    Loading Configuration:
        Reads and parses a YAML configuration file (config.yaml) that defines:
            Docker containers to be started for each user.
            Users participating in the CTF.
            Paths to SSH keys, WireGuard configurations, and other network details.
            Hosts where Docker containers will run.
            IP address subnets for network configuration.

    Establishing Connections:
        Sets up SSH connections using Paramiko and WireGuard connections as defined in the configuration.
        Manages SSH agent for key-based authentication during operations.

    Network and Container Management:
        Cleans up existing Docker containers and networks on specified hosts to ensure a clean state.
        Creates Docker networks for each user, ensuring isolated environments for containers.
        Deploys specified Docker containers for each user within their respective networks.

    Security and Configuration:
        Handles security configurations like setting up WireGuard VPN for secure connections to Docker hosts.
        Manages user-specific OpenVPN servers and configuration files for secure client-server communication within the CTF environment.

    Error Handling and Retry Mechanism:
        Implements error handling and retry mechanisms (via max_retries parameter) for critical operations like file downloads (using curl) and configuration modifications.
        Ensures robustness and reliability during setup and configuration phases.

    Output and Logging:
        Provides informative messages using click.echo to keep users informed about the progress and status of operations.
        Logs errors and exceptions to aid in debugging and troubleshooting.

## Credits

This is the CTF-Creator programmed by Nick NÃ¶tzel under the supervision of Stefan Machmeier.

## License
[EUPL](https://joinup.ec.europa.eu/sites/default/files/custom-page/attachment/2020-03/EUPL-1.2%20EN.txt)

